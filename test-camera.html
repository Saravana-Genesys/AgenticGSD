<!DOCTYPE html>
<html>
<head>
    <title>Camera/Mic Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .success {
            color: #10b981;
            background: #10b98120;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: #ef4444;
            background: #ef444420;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        video {
            width: 100%;
            max-width: 640px;
            background: #000;
            border-radius: 8px;
            margin: 20px 0;
        }
        pre {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üé• Camera & Microphone Test</h1>
    
    <div id="status"></div>
    
    <button onclick="listDevices()">1. List All Devices</button>
    <button onclick="testAudioOnly()">2. Test Microphone Only</button>
    <button onclick="testCameraAndMic()">3. Test Camera + Mic</button>
    
    <div id="devices"></div>
    <video id="video" autoplay playsinline muted></video>
    <div id="result"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const devicesDiv = document.getElementById('devices');
        const resultDiv = document.getElementById('result');
        const video = document.getElementById('video');

        // Check if getUserMedia is supported
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            statusDiv.innerHTML = '<div class="error">‚ùå Your browser does not support camera/microphone access. Try Chrome or Firefox.</div>';
        } else {
            statusDiv.innerHTML = '<div class="success">‚úÖ Browser supports camera/microphone access</div>';
        }

        async function listDevices() {
            try {
                devicesDiv.innerHTML = '<p>Checking available devices...</p>';
                
                const devices = await navigator.mediaDevices.enumerateDevices();
                
                const videoDevices = devices.filter(d => d.kind === 'videoinput');
                const audioDevices = devices.filter(d => d.kind === 'audioinput');
                
                let html = '<h3>Found Devices:</h3><pre>';
                
                html += `\nüìπ Video Devices (${videoDevices.length}):\n`;
                if (videoDevices.length === 0) {
                    html += '  ‚ùå No cameras found!\n';
                } else {
                    videoDevices.forEach((device, i) => {
                        html += `  ${i + 1}. ${device.label || 'Camera ' + (i + 1)} (${device.deviceId.substr(0, 20)}...)\n`;
                    });
                }
                
                html += `\nüé§ Audio Devices (${audioDevices.length}):\n`;
                if (audioDevices.length === 0) {
                    html += '  ‚ùå No microphones found!\n';
                } else {
                    audioDevices.forEach((device, i) => {
                        html += `  ${i + 1}. ${device.label || 'Microphone ' + (i + 1)} (${device.deviceId.substr(0, 20)}...)\n`;
                    });
                }
                
                html += '</pre>';
                
                if (videoDevices.length === 0 || audioDevices.length === 0) {
                    html += '<div class="error"><strong>‚ö†Ô∏è Issues Found:</strong><ul>';
                    if (videoDevices.length === 0) {
                        html += '<li>No camera detected. Is it connected?</li>';
                    }
                    if (audioDevices.length === 0) {
                        html += '<li>No microphone detected. Is it connected?</li>';
                    }
                    html += '</ul></div>';
                }
                
                devicesDiv.innerHTML = html;
            } catch (err) {
                devicesDiv.innerHTML = `<div class="error">‚ùå Error: ${err.message}</div>`;
            }
        }

        async function testAudioOnly() {
            try {
                resultDiv.innerHTML = '<p>Requesting microphone access...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, 
                    video: false 
                });
                
                resultDiv.innerHTML = '<div class="success">‚úÖ SUCCESS! Microphone is working!</div>';
                
                // Stop the stream
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    resultDiv.innerHTML += '<p>Test completed. Microphone released.</p>';
                }, 2000);
                
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">
                    ‚ùå <strong>Microphone Error:</strong><br>
                    <strong>Type:</strong> ${err.name}<br>
                    <strong>Message:</strong> ${err.message}<br><br>
                    ${getErrorHelp(err)}
                </div>`;
            }
        }

        async function testCameraAndMic() {
            try {
                resultDiv.innerHTML = '<p>Requesting camera and microphone access...</p>';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, 
                    video: true 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                
                resultDiv.innerHTML = '<div class="success">‚úÖ SUCCESS! Camera and microphone are working!</div>';
                
                // Stop after 10 seconds
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    video.srcObject = null;
                    video.style.display = 'none';
                    resultDiv.innerHTML += '<p>Test completed. Devices released.</p>';
                }, 10000);
                
            } catch (err) {
                video.style.display = 'none';
                resultDiv.innerHTML = `<div class="error">
                    ‚ùå <strong>Error:</strong><br>
                    <strong>Type:</strong> ${err.name}<br>
                    <strong>Message:</strong> ${err.message}<br><br>
                    ${getErrorHelp(err)}
                </div>`;
            }
        }

        function getErrorHelp(err) {
            switch(err.name) {
                case 'NotFoundError':
                    return `<strong>Fix:</strong>
                    <ul>
                        <li>No camera/microphone detected</li>
                        <li>Check if devices are connected</li>
                        <li>Try unplugging and reconnecting external devices</li>
                        <li>Restart your browser</li>
                    </ul>`;
                case 'NotAllowedError':
                    return `<strong>Fix:</strong>
                    <ul>
                        <li>You blocked the permission request</li>
                        <li>Click the camera icon in address bar</li>
                        <li>Change to "Allow"</li>
                        <li>Check System Settings ‚Üí Privacy & Security ‚Üí Camera/Microphone</li>
                    </ul>`;
                case 'NotReadableError':
                    return `<strong>Fix:</strong>
                    <ul>
                        <li>Device is in use by another application</li>
                        <li>Close Zoom, Teams, FaceTime, etc.</li>
                        <li>Restart your browser</li>
                    </ul>`;
                default:
                    return '<strong>Try:</strong> Check browser console for more details';
            }
        }

        // Auto-run device list on load
        window.addEventListener('load', listDevices);
    </script>
</body>
</html>
